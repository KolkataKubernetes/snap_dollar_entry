library('ellmer')
library(ellmer)
install.packages('ellmer')
install.packages("gander")
library('tidyverse')
library('ellmer')
library('gander')
options(.gander_chat = ellmer::chat_ollama(model = "llama3.2"))
paste(waiver_path,'2013_ABAWD_waiver.xlsx', sep = '/'
)
waiver_path = '/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels'
paste(waiver_path,'2013_ABAWD_waiver.xlsx', sep = '/')
dir(waiver_path)
for file in dir(waiver_path) (
for (file in dir(waiver_path)) {
filename <- substr(file, length(file) - 8, length(file))
filepath <- paste0(waiver_path, "/", file)
data <- readxl::read_excel(filepath)
# your subsequent code here for each excel file
}
View(data)
data
filename
sample_data_2015 <- read_csv(paste(waiver_path,'2015_ABAWD_waiver.xslx', sep = '/'))
paste(waiver_path,'2015_ABAWD_waiver.xslx', sep = '/')
sample_data_2015 <- read_csv('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
View(sample_data_2015)
sapply(sample_data_2015, class)
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_START
sapple(sample_data_2015, class)
sapply(sample_data_2015, class)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
sapply(sample_data_2015, class)
min(sample_data_2015$DATE_START)
max(sample_data_2015$DATE_START)
months_between <- min(sample_data_2015$DATE_START):max(sample_data_2015$DATE_END)
months_between
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx'))
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx'))
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx', sep = "/"))
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx', sep = "/"))
month_range <- sample_data_2015 %>%
summarise(
min_date = min(DATE_START),
max_date = max(DATE_END)
)
class()
month_range <- sample_data_2015 %>%
summarise(
min_date = min(DATE_START),
max_date = max(DATE_END)
)
month_range
months_between <- month_range$min_date:month_range$max_date
months_between
months_between <- month_range %>%
pull(min_date):pull(max_date)
month_range <- sample_data_2015 %>%
summarise(
min_date = as_date(min(DATE_START)),
max_date = as_date(max(DATE_END))
)
months_between <- month_range %>%
pull(min_date):pull(max_date)
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx', sep = "/"))
month_range <- sample_data_2015 %>%
summarise(
min_date = min(DATE_START),
max_date = max(DATE_END)
)
months_between <- month_range$min_date:month_range$max_date
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx'))
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx', sep = "/"))
month_range <- sample_data_2015 %>%
summarise(
min_date = min(DATE_START),
max_date = max(DATE_END)
)
months_between <- month_range$min_date:month_range$max_date
sample_data_2015 <- readxl::read_excel(paste(waiver_path,'2015_ABAWD_waiver.xlsx', sep = "/"))
month_range <- sample_data_2015 %>%
summarise(
min_date = as_date(min(DATE_START)),
max_date = as_date(max(DATE_END))
)
months_between <- month_range %>%
pull(min_date):pull(max_date)
options(.gander_chat = ellmer::chat_openai(model = "gpt-4o-mini"))
library('tidyverse')
library('ellmer')
library('gander')
waiver_path = '/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels'
sample_data_2015 <- read_csv(paste(waiver_path,'2015_ABAWD_waiver.xslx', sep = '/'))
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)))
library('zoo')
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)))
months_between
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
months_between
options(.gander_chat = ellmer::chat_ollama(model = "llama3.2"))
options(.gander_chat = ellmer::chat_ollama(model = "mistral7b"))
# Load Packages
library('tidyverse')
library('ellmer')
library('gander')
library('zoo')
options(.gander_chat = ellmer::chat_ollama(model = "mistral7b"))
ellmer::models_ollama()
options(.gander_chat = ellmer::chat_ollama(model = "mistral:7b"))
waiver_path = '/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels'
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
months_between
class(months_between)
months_between
type(months_between)
sample_data_2015 %>%
full_join(tibble(DATE = months_between), by = "value") %>%
mutate(DATE = as_date(paste0(DATE, "_01")) %>% as_yearmon) %>%
select(-c(YEAR))
options(.gander_chat = ellmer::chat_ollama(model = "llama3.2"))
options(.gander_chat = ellmer::chat_ollama(model = "mistral:7b"))
months_between <- paste(strsplit(as.character(months_between), " ")[[1]], collapse = "_")
months_between
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
months_between
months_between <- paste(strsplit(as.character(months_between), " "), collapse = "_")
months_between
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
months_between <- paste(format.date(months_between, format = "%b_%Y"), collapse = "_")
months_between <- paste(format(months_between, format = "%b_%Y"), collapse = "_")
months_between
months_between <- paste(format(months_between, format = "%b_%Y"), collapse = "_")
months_between
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
months_between <- paste(format(months_between, format = "%b_%Y"), collapse = "_")
months_between
month_names <- format(months_between, "%b_%Y")
month_names <- format(months_between, "%b_%Y")
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
month_names <- format(months_between, "%b_%Y")
collapsed_names <- paste(month_names, collapse = "_")
collapsed_names
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
# Create a column for each item in months_between
# Step 2: Format each month as "Mon_YYYY", e.g., "Jan_2015"
month_names <- format(months_between, "%b_%Y")
# (Optional) Collapse into one string if that's what you wanted
collapsed_names <- paste(month_names, collapse = "_")
print(collapsed_names)
print(month_names)
######################################################
# ETL: SNAP Waivers
# Inder Majumdar
######################################################
##############
#Config
##############
# Load Packages
library('tidyverse')
library('ellmer')
library('gander')
library('zoo')
# Set the reference model for gander
options(.gander_chat = ellmer::chat_ollama(model = "mistral:7b"))
# Set data path
waiver_path = '/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels'
##############
#Load Data
##############
#paste(waiver_path,'2013_ABAWD_waiver.xlsx', sep = '/')
##############
#Scratch - Example to transform data
##############
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
# Create a list of all month-year combos included in the data
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
# Create a column for each item in months_between
# Format each month as "Mon_YYYY", e.g., "Jan_2015"
months_between <- format(months_between, "%b_%Y")
months_between
full_data_2015 <- sample_data_2015 %>%
full_join(data.frame(month = months_between, value = rep(0)), by = "Date_Start") %>%
group_by(YEAR, STATE, STATE_ABBREV, ENTIRE_STATE, LOC, LOC_TYPE, DATE_START, DATE_END, SOURCE_DOC) %>%
mutate_all( ~ coalesce(., get( paste0("month", row_number())))) %>%
drop_na()
typeof(months_between)
class(months_between)
seq(1:5)
options(.gander_chat = ellmer::chat_ollama(model = "llama3.2"))
for (item in months_between) {
print(item)}
for (item in months_between) {
sample_data_2015$item = 0
}
saple_data_2015
sample_data_2015
View(sample_data_2015)
for (item in months_between) {
sample_data_2015[[paste("item_", item, sep = "_")]] <- 0
}
View(sample_data_2015)
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
# Create a list of all month-year combos included in the data
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
# Create a column for each item in months_between
# Format each month as "Mon_YYYY", e.g., "Jan_2015"
months_between <- format(months_between, "%b_%Y")
# Create
for (item in months_between) {
sample_data_2015[[paste(item)]] <- 0
}
for (i in 1:nrow(sample_data_2015)) {
print(i)
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
}
months_between
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (item in months_between) {
sample_data_2015[[paste(item)]][i] <- 1
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (item in months_between) {
sample_data_2015$paste(item)[i] <- 1
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (item in months_between) {
sample_data_2015$item[i] <- 1
}
}
######################################################
# ETL: SNAP Waivers
# Inder Majumdar
######################################################
##############
#Config
##############
# Load Packages
library('tidyverse')
library('ellmer')
library('gander')
library('zoo')
# Set the reference model for gander
options(.gander_chat = ellmer::chat_ollama(model = "llama3.2"))
# Set data path
waiver_path = '/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels'
##############
#Load Data
##############
#paste(waiver_path,'2013_ABAWD_waiver.xlsx', sep = '/')
##############
#Scratch - Example to transform data
##############
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015$DATE_START <- as_date(sample_data_2015$DATE_START)
sample_data_2015$DATE_END <- as_date(sample_data_2015$DATE_END)
# Create a list of all month-year combos included in the data
months_between <- seq(from = as.yearmon(min(sample_data_2015$DATE_START)), to = as.yearmon(max(sample_data_2015$DATE_END)), by = 1/12)
# Create a column for each item in months_between
# Format each month as "Mon_YYYY", e.g., "Jan_2015"
months_between <- format(months_between, "%b_%Y")
# Create one column for each
for (item in months_between) {
sample_data_2015[[paste(item)]] <- 0
}
# For each row, construct a months_between list. For each item in the list, flip the corresponding column dummy value to 1.
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (item in months_between) {
sample_data_2015$item[i] <- 1
}
}
ite
item
months_between
months_between[1]
nrow(months_between)
size_sum(months_between)
size(months_between)
length(months_between)
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (j in length(months_between)) {
temp <- months_between[j]
#sample_data_2015$paste()
}
}
j
j
months_between
months_between[j]
temp
sample_data_2015$[[paste(temp)]]
sample_data_2015$[paste(temp)]
sample_data_2015$paste(temp)
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp, "_", as.character(as.yearmon(temp)))][i])
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12)
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp)][i])
}
}
temp
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp)][i])
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp)])
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp)][[i]])
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[, paste(temp)])
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in 1:length(months_between)) {
temp <- months_between[j]
print(sample_data_2015[i, temp])
}
}
for (i in 1:nrow(sample_data_2015)) {
months_between <- format(seq(from = as.yearmon(sample_data_2015$DATE_START[i]), to = as.yearmon(sample_data_2015$DATE_END[i]) , by = 1/12),"%b_%Y")
for (j in 1:length(months_between)) {
temp <- months_between[j]
sample_data_2015[i, temp] <- 1
}
}
View(sample_data_2015)
waiver_data <- data_frame()
waiver_data <- tibble()
waiver_data
waiver_data <- tibble()
waiver_dir <- dir(waiver_path)
for (file in waiver_dir) {
print(file)
# waiver_data <- waiver_data %>%
#  add_column(file = file, .data = character(1)) }
}
for (file in waiver_dir) {
temp <- readxl::read_excel(paste(waiver_path, file, sep = "/"))
# waiver_data <- waiver_data %>%
#  add_column(file = file, .data = character(1)) }
}
temp
paste(waiver_path, file, sep = "/")
temp
sample_data_2015
sample_data_2015 <- readxl::read_excel('/Users/indermajumdar/Library/CloudStorage/Box-Box/SNAP Dollar Entry/data/waivers/panels/2015_ABAWD_waiver.xlsx')
sample_data_2015
